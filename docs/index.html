<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jawun Research Centre">
<meta name="dcterms.date" content="2024-03-07">

<title>Summary Report: Yarning Circle Phase 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Summary Report: Yarning Circle Phase 1</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jawun Research Centre </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 7, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<style type="text/css">
.justify {
  text-align: justify !important
}
</style>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="title_banner.png" class="img-fluid figure-img"></p>
<figcaption>Figure - Title Banner</figcaption>
</figure>
</div>
<section id="a.-executive-summary" class="level1">
<h1>A. Executive Summary</h1>
<div class="justify">
<p>This research project is part of the development of communication training for non-Indigenous mental health professionals or clinicians, aimed at improving mental health communication with Aboriginal and Torres Strait Islander patients. It is acknowledged that First Nations Australians have poorer health outcomes compared to the non-Indigenous population. In the space of mental health services, quality mental health communication between non-Indigenous clinicians and First Nations patients can address this health disparity.</p>
<p>Yarning circles were conducted across four hospitals and health services in Queensland, involving more than 136 non-Indigenous clinicians and Aboriginal Torres Strait Islander mental health workers. They shared their experiences in communicating with First Nations patients and strategies to develop effective communication. Findings indicate that clinicians need to hold core values of respecting First Nations patients and acquire crucial skills such as building rapport, understanding local customs, and using layperson terms. Furthermore, clinicians need to understand the patient’s history of oppression, experience of transgenerational trauma, and ongoing racism to fully implement a person-centered approach in delivering mental health services.</p>
<p>The implication of these findings is the preparation for the next part of the study, where the patient’s voice will be the main focus in validating the current findings and informing the training development. The findings also challenge the existing health system, suggesting that changes are needed at the system level to provide clinicians with the flexibility to realise quality mental health communication and subsequently improve mental health services for First Nations patients.</p>
</div>
</section>
<section id="b.-introduction-and-background" class="level1">
<h1>B. Introduction and Background</h1>
<div class="justify">
<p>In Australia, almost 1 in 3 Aboriginal and Torres Strait Islander adults (31% or 149,400) had high to very high levels of psychological distress in 2018–19, more than twice the levels of non-Indigenous adults (13%) <span class="citation" data-cites="aihw2020">(<a href="#ref-aihw2020" role="doc-biblioref">Australian Institute of Health and Welfare 2020</a>)</span>. In Queensland, mental health is a leading contributor to burden of disease, accounting for approximately 20% of the total disease burden experienced by Aboriginal and Torres Strait Islander peoples <span class="citation" data-cites="qldhealth2016">(<a href="#ref-qldhealth2016" role="doc-biblioref">Health 2016</a>)</span>. The National Aboriginal and Torres Strait Islander Leadership in Mental Health (NATSILMH) highlighted a need for culturally appropriate and accountable mental health services <span class="citation" data-cites="dudgeon2016">(<a href="#ref-dudgeon2016" role="doc-biblioref">Dudgeon et al. 2016</a>)</span>.A crucial next step in service development is to ensure that mental health services are culturally sensitive and safe, providing access to staff who practice respectful, reciprocal and person/family/community centric communication.This project will build a cross-disciplinary research team led by Aboriginal and Torres Strait Islander researchers and mental health clinicians. We will engage with Aboriginal and Torres Strait Islander consumers and communities, services providers, and policy makers to co-design and evaluate a patient-centred and culturally sensitive communication training package for non-Indigenous mental health professionals with a goal of improving health outcomes for Aboriginal and Torres Strait Islander patients accessing mental health services.</p>
<p>This project aims to co-design, deliver and evaluate a patient-centred and culturally sensitive communication training package for non-Indigenous mental health professionals, with the goals of: 1) improving health outcomes for Aboriginal and Torres Strait Islander patients accessing Queensland health mental health services and 2) building a culturally competent, responsive and clinically safe mental health workforce. Specifically, this report outlines the results of the yarning circles, during which mental health professionals share their thoughts, ideas, and experiences regarding their interactions with Aboriginal and Torres Strait Islander patients or clients.</p>
<p>This report is being prepared to inform the development of communication training for non-Indigenous mental health professionals. It is being circulated back to the research participants to allow them to provide feedback, ensuring the accuracy of the interpretation from the yarning circles. Ultimately, participants of the yarning circles can connect us with the Aboriginal and Torres Strait Islander patients who will take part in the second stage of the yarning circles.</p>
</div>
</section>
<section id="c.-research-activity" class="level1">
<h1>C. Research Activity</h1>
<div class="justify">
<p>Yarning circles have been conducted with mental health professionals and Aboriginal and Torres Strait Islander mental health workers across three Hospital and Health Services in Queensland from October 2022 to October 2023. A total of 136 research participants discussed and yarned their experiences with mental health communication with Aboriginal and Torres Strait Islander patients. They also shared strategies and barriers to building effective communication. Future yarning circles are planned to be conducted in Cairns. The following breakdown outlines the details of the research activity.</p>
</div>
<table class="table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Metro North</th>
<th>Metro South</th>
<th>Central Queensland</th>
<th>Cairns</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Number of Yarning Circles</td>
<td>6</td>
<td>5</td>
<td>7</td>
<td>TBA</td>
</tr>
<tr class="even">
<td>Number of all participants</td>
<td>38</td>
<td>44</td>
<td>53</td>
<td>TBA</td>
</tr>
<tr class="odd">
<td>Non-Indigenous clinicians</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>✦ Nurses</td>
<td>7</td>
<td>11</td>
<td>TBC</td>
<td>TBA</td>
</tr>
<tr class="odd">
<td>✦ Social worker</td>
<td>8</td>
<td>11</td>
<td>TBC</td>
<td>TBA</td>
</tr>
<tr class="even">
<td>✦ Psychologist</td>
<td>0</td>
<td>5</td>
<td>TBC</td>
<td>TBA</td>
</tr>
<tr class="odd">
<td>✦ Team leader</td>
<td>4</td>
<td>3</td>
<td>TBC</td>
<td>TBA</td>
</tr>
<tr class="even">
<td>✦ Others</td>
<td>9</td>
<td>7</td>
<td>TBC</td>
<td>TBA</td>
</tr>
<tr class="odd">
<td>Aboriginal and Torres Strait Islander mental health workers</td>
<td>10</td>
<td>7</td>
<td>TBC</td>
<td>TBA</td>
</tr>
<tr class="even">
<td>Identified Gender</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>✦ Male</td>
<td>14</td>
<td>19</td>
<td>TBC</td>
<td>TBA</td>
</tr>
<tr class="even">
<td>✦ Female</td>
<td>24</td>
<td>25</td>
<td>TBC</td>
<td>TBA</td>
</tr>
</tbody>
</table>
</section>
<section id="d.-results" class="level1">
<h1>D. Results</h1>
<div class="justify">
<p><strong>Mental Health Professionals (Clinicians) Level.</strong> Our findings show that clinicians’ core values and specific skillsets may be key to effective mental health communication. Core values, such as genuine care for Aboriginal and Torres Strait Islander patients and a genuine curiosity to learn from them, can help develop effective communication. This genuineness also includes acknowledging the limitations of their services, which can help patients set the right expectations for the service. Additionally, clinicians should see all patients as equals. This perspective can help build a trusting relationship with the patient, rather than seeing them as objects that need to follow orders and directions. Lastly, clinicians need to have humility to acknowledge their biases and be open to respecting others’ perspectives, including those from their encounters with Aboriginal and Torres Strait Islander patients, their cultures, customs, and belief systems.</p>
<p>It is also evident from the yarning circles that rapport-building skills are highly essential to establish a trusting relationship with the patient. Additionally, clinicians need to avoid using clinical jargon and instead use layperson terms. Another important skill is engaging the patient in an empowering conversation. For example, clinicians need to listen attentively to the patient’s needs. Offering the patient options, such as tea or coffee, and allowing them to choose where to sit, such as at a table or on a comfortable couch, can also help the patient feel empowered.</p>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="clinician_level.png" class="img-fluid figure-img"></p>
<figcaption>Figure - Clinician Level</figcaption>
</figure>
</div>
<div class="justify">
<p><strong>Aboriginal and Torres Strait Islander Patients Level.</strong> In addition to clinicians’ core values and skills, it is expected that clinicians should be aware of their patients’ cultural and historical contexts. The cultural context may include the significant role of family and kinship for Aboriginal and Torres Strait Islander patients. Furthermore, clinicians should also familiarise themselves with the local culture where they are based. For example, offering food can be a good strategy to initiate rapport, but certain food sources can be considered sacred to Indigenous people in a particular country. Lastly, clinicians may need to understand the local communication style and sense of humour, which might differ from their own communication style.</p>
<p>Further, understanding the historical context may assist the clinician in delivering people-centred service. The clinician needs to understand the full context of their patients’ experiences, which may include transgenerational trauma due to the history of colonisation, experiences of racism, and being part of the Stolen Generation. The patient’s ongoing experience of racism and mistreatment by society and authority figures, such as the police, can shed light on why the patient resists mental health services.</p>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="patient_level.png" class="img-fluid figure-img"></p>
<figcaption>Figure - Patient Level</figcaption>
</figure>
</div>
<div class="justify">
<p><strong>(Mental) Health System Level.</strong> This section covers a broader range of factors impacting effective health communication. It is noted that the demographic aspect plays a role, as patients in rural or regional areas often have stronger bonds with their communities and may have different experiences with services. For example, Aboriginal and Torres Strait Islander people in rural areas have a higher chance of being transferred to a larger hospital in the city to receive more comprehensive treatment. Additionally, a patient’s age and gender can influence their communication style, with younger patients tending to be more open to communicating with non-Indigenous clinicians. Lastly, it is important for clinicians to understand that Aboriginal and Torres Strait Islander peoples are not a homogenous group and have unique customs and traditions.</p>
<p>At an even broader level, mental health communication also depends on the current situation within the health system. For example, while clinicians may try to take the time to build connections with their patients, they are often required to complete forms and mental status examinations within a timeframe to meet performance indicators. It is also essential for clinicians to be open to understanding the local health model in addition to the Western health model. This openness to the local health model will support them in using a person-centered approach when treating Aboriginal and Torres Strait Islander patients. Lastly, the type of services available, such as long-term facilities, acute care, and emergency departments, may determine the balance in building rapport, creating therapeutic relationships, and managing crises.</p>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="system_level.png" class="img-fluid figure-img"></p>
<figcaption>Figure - System Level</figcaption>
</figure>
</div>
<div class="justify">
<p><strong>Aboriginal and Torres Strait Islander mental health workers.</strong> Our findings also highlight the important role of Aboriginal and Torres Strait Islander mental health workers in facilitating effective communication. However, they are often underappreciated, and many health services do not include them as part of their teams. Their roles are often misunderstood, with some seeing them only as interpreters or staff who are called upon when there is an escalation. This finding emphasises the need for clinicians to understand and engage in professional collaboration with Aboriginal and Torres Strait Islander mental health workers to deliver person-centred mental health services.</p>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mhworkers.png" class="img-fluid figure-img"></p>
<figcaption>Figure - Mental Health Workers</figcaption>
</figure>
</div>
<div class="justify">
<p><strong>The Communication Training Package.</strong> All the findings described previously will be used to inform the development of the training. In addition, yarning circles have provided us with other valuable insights. For instance, the training content should include techniques for de-escalating tension. The initial stages of a clinical interaction are crucial for building rapport; therefore, the training should also cover strategies for how clinicians introduce themselves and sensitively ask for the patient’s personal information. Clinicians should also learn how to establish common ground with Aboriginal and Torres Strait Islander patients and use self-disclosure carefully during sessions.</p>
<p>Most research participants indicated a preference for face-to-face, full-day training conducted off-site from their workplace so they can concentrate on the training. However, it is important to consider that full-day training might create complications with scheduling rostering. The training content should also include practical skills, allowing participants to learn interactively through case scenarios and role modelling. For example, the trainer could demonstrate a case example, and participants would analyse the effectiveness of the communication. On the other hand, role-playing seems to be the least preferred method. Lastly, the communication training needs to promote behavioural and mindset changes. In other words, the training should not only serve as a template or checklist for communicating with Aboriginal and Torres Strait Islander patients.</p>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="comm_training.png" class="img-fluid figure-img"></p>
<figcaption>Figure - Communication Training</figcaption>
</figure>
</div>
</section>
<section id="e.-moving-forward" class="level1">
<h1>E. Moving Forward</h1>
<div class="justify">
<p>In this report, we have outlined findings from the yarning circles with non-Indigenous mental health professionals and Aboriginal and Torres Strait Islander mental health workers. It is highlighted that clinicians should hold a core values in respecting the First Nations patients and put the patient at the forefront of the service. In addition to a genuine care to the patient, clinicians should also acquire skills, such as, rapport building, using payperson terms, and professionally work alongside the Indigenous mental health workers. Further, clinicians should also aware the historical and cultural contexts of their First Nations patients which will facilitate a more person-centred approach. Our findings also acknowledge that systemic changes in health system is inevitable to make the effective mental health communication to take place. Therefore, this research will not stop here.</p>
<p>The next step of this training development will be conducting yarning circles with the Aboriginal and Torres Strait Islander patients. In alignment with the co-design process, it is important for the communication training to be developed with the patient-centred perspective. It is believed that the patient’s input and experiences will further enhance our findings as described before. Eventually, the clinicians will receive this patient-centred communication training through the Phase 2 of the study. Further, we are committed to advocate the systemic-level changes to realise the quality services for the Aboriginal and Torres Strait Islander peoples.</p>
</div>
</section>
<section id="references" class="level1">
<h1>References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-aihw2020" class="csl-entry" role="listitem">
Australian Institute of Health and Welfare. 2020. <em>Aboriginal and Torres Strait Islander Health Performance Framework 2020 Summary Report</em>. IHPF 2. Canberra: AIHW.
</div>
<div id="ref-dudgeon2016" class="csl-entry" role="listitem">
Dudgeon, Pat, Tom Calma, Tony Brideson, and Christopher Holland. 2016. <span>“The Gayaa Dhuwi (Proud Spirit) Declaration - a Call to Action for Aboriginal and Torres Strait Islander Leadership in the Australian Mental Health System.”</span> <em>Advances in Mental Health</em> 14 (2): 126–39.
</div>
<div id="ref-qldhealth2016" class="csl-entry" role="listitem">
Health, Queensland. 2016. <em>Connecting Care to Recovery 2016-2021: A Plan for Queensland’s State-Funded Mental Health, Alcohol and Other Drugs Services</em>.
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>